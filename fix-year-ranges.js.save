import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å–æ–±—ã—Ç–∏–π
const eventsPath = path.join(__dirname, '../public/events.json');
const backupPath = path.join(__dirname, '../public/events-backup.json');

// –î–µ–ª–∞–µ–º –±—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
fs.copyFileSync(eventsPath, backupPath);
console.log('üß© Backup created: events-backup.json');

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–±—ã—Ç–∏—è
const events = JSON.parse(fs.readFileSync(eventsPath, 'utf-8'));
let fixedCount = 0;

// –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —Å–æ–±—ã—Ç–∏—è–º
events.forEach(event => {
  // –ò—â–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –ª–µ—Ç –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä (1803‚Äì1815)
  const rangeMatch = event.title.match(/\((\d{3,4})[‚Äì-](\d{3,4})\)/);

  if (rangeMatch) {
    const startYear = rangeMatch[1];
    const endYear = rangeMatch[2];
    const fullRange = `${startYear}‚Äì${endYear}`;

    // –ï—Å–ª–∏ –≤ –ø–æ–ª–µ year —É–∫–∞–∑–∞–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –≥–æ–¥ ‚Äî –∏—Å–ø—Ä–∞–≤–ª—è–µ–º
    if (event.year !== fullRange) {
      console.log(`Fixing: ${event.title}`);
      console.log(`  Old year: ${event.year || 'missing'}`);
      console.log(`  New year: ${fullRange}`);
      event.year = fullRange;
      fixedCount++;
    }
  }
});

// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ
fs.writeFileSync(eventsPath, JSON.stringify(events, null, 2));
console.log(`\n‚úÖ Fixed year ranges for ${fixedCount} events`);
