# Руководство по работе с изображениями событий

## Структура данных

Каждое событие в `public/events.json` может иметь поле `image`:

```json
{
  "id": "bam_earthquake_2003",
  "type": "earthquake",
  "title": "2003 Bam earthquake",
  "country": "IR",
  "pos": { "lat": 29.1, "lng": 58.36 },
  "desc": "...",
  "wiki": "https://en.wikipedia.org/wiki/2003_Bam_earthquake",
  "image": "https://upload.wikimedia.org/wikipedia/commons/...",
  "year": "2003",
  "casualties": 26271
}
```

## Автоматическое заполнение изображений

Используйте скрипт `scripts/fill-missing-images.js` для автоматического добавления изображений из Wikipedia:

```bash
node scripts/fill-missing-images.js
```

### Что делает скрипт:

1. Читает `public/events.json`
2. Для каждого события без поля `image`:
   - Извлекает название статьи из `event.wiki`
   - Запрашивает главное изображение через MediaWiki API
   - Записывает URL изображения в поле `image`
3. Сохраняет обновленный файл
4. Создает отчет в `images-fill-report.json`

### Особенности:

- ✅ Создает резервную копию (`events-backup-images.json`)
- ✅ Пропускает события, у которых уже есть изображение
- ✅ Обрабатывает ошибки без падения
- ✅ Соблюдает rate limits (100ms между запросами)
- ✅ Логирует прогресс в консоль

## Отображение на сайте

### На карте (попапы)

Изображения автоматически отображаются в попапах при клике на маркер события. Если `event.image` отсутствует, изображение просто не показывается.

### На странице события

На странице `/event/[slug]`:
- Изображение показывается в карточке "Overview" если `event.image` задано
- Если изображения нет, карточка показывает только текст
- Изображение оптимизировано (lazy loading, максимальная высота 384px)

### Open Graph / Social Media

В `<head>` автоматически добавляются теги:
- `og:image` — для Facebook/LinkedIn
- `twitter:image` — для Twitter/X
- `og:image:alt` — описание изображения

Если `event.image` отсутствует, используется дефолтный лого сайта.

## Ручное добавление изображений

Вы можете вручную добавить URL изображения в поле `image`:

```json
"image": "https://upload.wikimedia.org/wikipedia/commons/thumb/a/b/c.jpg/1024px-c.jpg"
```

**Рекомендации:**
- Используйте прямые ссылки на изображения (не страницы)
- Предпочтительно использовать Wikimedia Commons
- Оптимальный размер: 1000-1920px по ширине
- Формат: JPG или PNG

## Безопасность и производительность

### ✅ Что мы делаем правильно:

- Никаких запросов к Wikipedia из браузера пользователя
- Все изображения загружаются напрямую с Wikimedia CDN
- Lazy loading для оптимизации производительности
- Обработка ошибок загрузки изображений

### ❌ Чего мы избегаем:

- Динамических запросов к MediaWiki API из браузера
- CORS проблем
- Замедления загрузки страниц
- Лишних HTTP запросов

## Обновление данных

### При добавлении новых событий:

1. Добавьте события в `public/events.json` без поля `image`
2. Запустите `node scripts/fill-missing-images.js`
3. Проверьте отчет в `images-fill-report.json`
4. Коммитьте обновленный `events.json`

### При обновлении существующих событий:

Если нужно заменить изображение:
1. Измените `image` URL напрямую в данных
2. Или удалите поле `image` и запустите скрипт заново

## Troubleshooting

### Скрипт не находит изображения

- Проверьте корректность URL в поле `wiki`
- Убедитесь, что статья на Wikipedia имеет основное изображение
- Некоторые статьи могут не иметь подходящих изображений

### Изображение не отображается на сайте

- Проверьте URL изображения в браузере
- Убедитесь, что URL начинается с `https://`
- Wikimedia может иногда менять структуру URL

### Rate Limiting

Если обрабатываете более 1000 событий:
- Увеличьте задержку в скрипте (с 100ms до 200ms)
- Или разбейте обработку на несколько запусков
